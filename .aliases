#!/bin/bash

#
# Aliases File
# Part of koconder/dotfiles
#

# Enable aliases to be sudo’ed
alias sudo='sudo '

# Mac Specific
if [[ "$OSTYPE" == "darwin"* ]]; then
    # Setup PHP
    if [[ -z "${MAMP_LATEST_PHP:-}" && -d "/Applications/MAMP/bin/php" ]]; then
        MAMP_LATEST_PHP=$(ls /Applications/MAMP/bin/php/ 2>/dev/null | sort -V | tail -1)
    fi
    if [[ -n "${MAMP_LATEST_PHP:-}" ]]; then
        alias php="/Applications/MAMP/bin/php/${MAMP_LATEST_PHP}/bin/php"
    fi

    # UpdateDB
    alias updatedb="sudo /usr/libexec/locate.updatedb"

    # Preferred 'ls' implementation with icon toggle
    if command -v eza >/dev/null 2>&1; then
        if [[ -n "${DOTFILES_DISABLE_EZA_ICONS:-}" ]]; then
            alias ls='eza -lh --git --no-user'
            alias ll='eza -lha --git --no-user'
        else
            alias ls='eza -lh --git --icons --no-user'
            alias ll='eza -lha --git --icons --no-user'
        fi
    else
        alias ls='ls -FGh'
        alias ll='ls -FGgoAhp'
    fi

	# Editor
	if command -v nvim >/dev/null 2>&1; then
		alias vim='nvim'
	fi

	# Open Current Path in Finder
	alias f='open -a Finder ./'

	# Tailscale CLI
	alias tailscale="/Applications/Tailscale.app/Contents/MacOS/Tailscale"

	# Fallback for Mac OS
	command -v md5sum > /dev/null || alias md5sum="md5"
	command -v sha1sum > /dev/null || alias sha1sum="shasum"

	# Pipe content to file on MacOS Desktop
	alias loghome='tee ~/Desktop/logfile_$(date +"%Y%m%d_%H%M%S").txt'

	# Kubernetes
	alias k='kubectl'
	alias kx='kubectx'
	alias kn='kubens'
	alias kpf='k get pods | fzf'
	alias ks='stern -n dev'
	function klogs() {
	  POD=$(k get pods --no-headers | fzf | awk '{print $1}')
	  [ -n "$POD" ] && kubectl logs -f "$POD"
	}
else
    # Preferred 'ls' implementation (Linux)
    if command -v eza >/dev/null 2>&1; then
        if [[ -n "${DOTFILES_DISABLE_EZA_ICONS:-}" ]]; then
            alias ls='eza -lh --git --no-user'
            alias ll='eza -lha --git --no-user'
        else
            alias ls='eza -lh --git --icons --no-user'
            alias ll='eza -lha --git --icons --no-user'
        fi
    else
        alias ls='ls --color=auto -Fh'
        alias ll='ls --color=auto -FgoAhp'
    fi

	# Pipe content to file in Home drive
	alias loghome='tee $HOME/logfile_$(date +"%Y%m%d_%H%M%S").txt'

	# Linux alternatives for macOS commands
	alias localip="hostname -I | awk '{print \$1}'"
	alias flushdns='sudo systemd-resolve --flush-caches 2>/dev/null || sudo resolvectl flush-caches 2>/dev/null || echo "DNS flush not available"'

fi

#
# Adjustments
#

	# Preferred Options and Replacements
	if command -v tldr >/dev/null 2>&1; then
		alias man='tldr'
	fi
	# alias dig='dog'
	# alias digs='dog -1'
	alias domain='dig +trace'
	alias cp='cp -iv'
	alias mv='mv -iv'
	alias mkdir='mkdir -pv'
	alias vi='vim'
	if command -v gping >/dev/null 2>&1; then
		alias ping='gping'
	fi

	# Easier navigation
	alias ~="cd ~"
	alias cd..='cd ../'
	alias ..='cd ../'
	alias ...='cd ../../'
	alias .3='cd ../../../'
	alias .4='cd ../../../../'
	alias .5='cd ../../../../../'
	alias .6='cd ../../../../../../'
	# alias --="cd -" #previous folder

	# Quick Folder Shortcuts
	alias dl="cd ~/Downloads"
	alias desk="cd ~/Desktop/"
	alias g="cd ~/GIT"
	alias i="cd ~/Library/Mobile\ Documents/com~apple~CloudDocs/"
	alias dotfiles="cd ~/Library/Mobile\ Documents/com~apple~CloudDocs/dotfiles"

	# Python venv
	alias venv='source .venv/bin/activate'
	alias mkvenv='python3 -m venv .venv && source .venv/bin/activate'

	# Docker
	alias d='docker'
	alias dc='docker compose'

	# Terraform
	alias tf='terraform'

	# Tree view (eza)
	command -v eza >/dev/null 2>&1 && alias tree='eza --tree'

	# Colour Output
	alias grep='grep --color=auto'
	alias fgrep='fgrep --color=auto'
	alias egrep='egrep --color=auto'
	alias phpunit='phpunit --colors'

	# Git
	alias ga='git add'
	alias gs='git status'
	alias gl='git pull --prune'
	alias glog="git log --graph --pretty=format:'%Cred%h%Creset %an: %s - %Creset %C(yellow)%d%Creset %Cgreen(%cr)%Creset' --abbrev-commit --date=relative"
	alias gp='git push origin HEAD'
	alias gd='git diff'
	alias gc='git commit'
	alias gca='git commit -a'
	alias gcm='git commit -m'
	alias gco='git checkout'
	alias gb='git branch'
	alias gf='git fetch'
	alias stash="git stash -u"
	alias pop="git stash pop"
#
# Terminal
#

	# Run Last as Sudo
	alias fuck='sudo $(history -p \!\!)'

	# Restore terminal settings when screwed up
	alias fix_stty='stty sane'

	# Terminal Tweaks
	alias c='clear'
	alias h='history'
	alias j='jobs -l'

	# History search
	alias hs='history | grep'
	hf() {
		if [[ -n "$1" ]]; then
			history | grep "$1" | fzf --tac --no-sort
		else
			history | fzf --tac --no-sort
		fi
	}

	# Print PATH's
	alias path='echo -e ${PATH//:/\\n}'

	# Set EDITOR as edit command
	alias edit='"${EDITOR}"'

	# chmod
	alias chmodx='chmod +x'

	# tasks
	if command -v htop >/dev/null 2>&1; then
		alias top='htop'
		if command -v sudo >/dev/null 2>&1; then
			alias htop='sudo htop'
		fi
		alias running='htop'
	fi

	# the "kp" alias ("que pasa")
	alias kp="ps auxwww"

#
# Network
#

	# Print ip's
	alias myip='dig myip.opendns.com @resolver1.opendns.com'
	alias localip="ipconfig getifaddr en0"

#
# Utilities
#
	# Empty the Trash on all mounted volumes and the main HDD.
	# Also, clear Apple’s System Logs to improve shell startup speed.
	# Finally, clear download history from quarantine. https://mths.be/bum
	alias emptytrash="sudo rm -rfv /Volumes/*/.Trashes; sudo rm -rfv ~/.Trash; sudo rm -rfv /private/var/log/asl/*.asl; sqlite3 ~/Library/Preferences/com.apple.LaunchServices.QuarantineEventsV* 'delete from LSQuarantineEvent'"

	# URL-encode strings
    alias urlencode='python3 -c "import sys; from urllib.parse import quote_plus; print(quote_plus(sys.argv[1]))"'

	# weather
	alias weather='curl https://wttr.in/ -A "ReqBin Curl Client/1.0"'
	alias moon='curl https://wttr.in/moon -A "ReqBin Curl Client/1.0"'

	# date
	alias today='date +"%Y/%m/%d"'
	alias fancydate='date +"It is %r %Z on %A, %B %d, %Y."'
	alias timestamp='date +"%Y%m%d_%H%M%S"'


# Networking (cross-platform)
alias netcons='lsof -i'                             # netcons:      Show all open TCP/IP sockets
alias lsock='sudo lsof -i -P'                       # lsock:        Display open sockets
alias lsockU='sudo lsof -nP | grep UDP'             # lsockU:       Display only open UDP sockets
alias lsockT='sudo lsof -nP | grep TCP'             # lsockT:       Display only open TCP sockets
alias openPorts='sudo lsof -i | grep LISTEN'        # openPorts:    All listening connections
alias ports='netstat -tulanp 2>/dev/null || lsof -i -P | grep LISTEN'  # ports: Show listening ports
alias myhostedit='sudo vim /etc/hosts'

# Networking (macOS-specific)
if [[ "$OSTYPE" == "darwin"* ]]; then
    alias flushdns='dscacheutil -flushcache && sudo killall -HUP mDNSResponder'
    alias localip='ipconfig getifaddr en0'
    alias ipinfo0='ipconfig getpacket en0'
    alias ipinfo1='ipconfig getpacket en1'
fi

# SSH folder (if Dropbox is set up)
[[ -d ~/Dropbox/_System/SSH ]] && alias myssh='cd ~/Dropbox/_System/SSH/'

# Aliases cheatsheet
help-aliases() {
    cat <<'EOF'
┌───────────────────────────────────────────────────────────────────────────┐
│                            ALIASES CHEATSHEET                             │
├───────────────────┬───────────────────┬───────────────────┬───────────────┤
│ NAVIGATION        │ FILES             │ GIT               │ CONTAINERS    │
├───────────────────┼───────────────────┼───────────────────┼───────────────┤
│ ..    up 1        │ ls    list        │ gs    status      │ d     docker  │
│ ...   up 2        │ ll    list all    │ ga    add         │ dc    compose │
│ .3    up 3        │ f     Finder      │ gc    commit      │ k     kubectl │
│ ~     home        │ tree  tree view   │ gcm   commit -m   │ kx    kubectx │
│ dl    Downloads   │ edit  $EDITOR     │ gd    diff        │ kn    kubens  │
│ desk  Desktop     │ chmodx chmod +x   │ gl    pull        │ klogs fzf log │
│ g     ~/GIT       │                   │ gp    push        │ tf    terrafrm│
│ i     iCloud      │ PYTHON            │ gco   checkout    │               │
│ dotfiles  cd      │ ─────────────     │ gb    branch      │ NETWORK       │
│                   │ venv    activate  │ gf    fetch       │ ────────────-─│
│ TERMINAL          │ mkvenv  create    │ glog  log graph   │ myip    extrnl│
│ ─────────────     │                   │ stash stash -u    │ localip local │
│ c     clear       │ UTILS             │ pop   stash pop   │ flushdns flush│
│ h     history     │ ─────────────     │                   │ ports   listng│
│ hs    hist+grep   │ today   YYYY/MM/DD│                   │ weather wttr  │
│ hf    hist+fzf    │ timestamp YMD_HMS │                   │ netcons socket│
│ path  show $PATH  │ urlencode encode  │                   │               │
│ kp    ps aux      │ emptytrash clear  │                   │               │
└───────────────────┴───────────────────┴───────────────────┴───────────────┘
EOF
}
alias halp='help-aliases'
alias cheat='help-aliases'
